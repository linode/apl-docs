"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[5716],{8234:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"get-started/labs/create-images","title":"Create container images","description":"The Harbor App needs to be activated for this lab.","source":"@site/docs/get-started/labs/create-images.md","sourceDirName":"get-started/labs","slug":"/get-started/labs/create-images","permalink":"/docs/get-started/labs/create-images","draft":false,"unlisted":false,"editUrl":"https://github.com/linode/linode.github.io/tree/main/docs/get-started/labs/create-images.md","tags":[],"version":"current","frontMatter":{"slug":"create-images","title":"Create container images","sidebar_label":"Create Container Images"},"sidebar":"mainSidebar","previous":{"title":"Register Code Repositories","permalink":"/docs/get-started/labs/register-repos"},"next":{"title":"Trigger Builds","permalink":"/docs/get-started/labs/trigger-builds"}}');var s=i(4848),l=i(8453);const r={slug:"create-images",title:"Create container images",sidebar_label:"Create Container Images"},a=void 0,d={},o=[{value:"Create the blue image",id:"create-the-blue-image",level:2},{value:"Manually re-run the build task (optional)",id:"manually-re-run-the-build-task-optional",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"The Harbor App needs to be activated for this lab."})}),"\n",(0,s.jsxs)(n.p,{children:["You can use the Container Images feature in App Platform to create container images from source with pre-configured Tekton pipelines using the ",(0,s.jsx)(n.a,{href:"https://buildpacks.io/docs/buildpack-author-guide/package-a-buildpack/",children:"paketo"})," (used by Buildpacks mode) task or the ",(0,s.jsx)(n.a,{href:"https://github.com/GoogleContainerTools/kaniko",children:"Kaniko"})," task (used by the Docker mode) to build images from application source."]}),"\n",(0,s.jsx)(n.h2,{id:"create-the-blue-image",children:"Create the blue image"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In the left menu, click on ",(0,s.jsx)(n.code,{children:"Container Images"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Click on ",(0,s.jsx)(n.code,{children:"CREATE CONTAINER IMAGE"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Select the ",(0,s.jsx)(n.code,{children:"Docker"})," build task."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Select the ",(0,s.jsx)(n.code,{children:"blue"})," repository from the Repository drop-down list."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"kubecfg",src:i(7390).A+"",width:"3042",height:"1678"})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Select the Reference (branch or tag). The ",(0,s.jsx)(n.code,{children:"blue"})," repo only has one branch (",(0,s.jsx)(n.code,{children:"main"}),")."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Optionally you can change the Image name and tag. This is the name and tag used to store the image in the private Harbor image registry."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Click ",(0,s.jsx)(n.code,{children:"Create Container Image"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Now a Tekton Pipeline and PipelineRun resource to build the image will be created by the App Platform. This will take around 30 seconds. Then the PipelineRun will start building the image. During this time the status will show ",(0,s.jsx)(n.code,{children:"in progress"}),":"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"build status",src:i(1343).A+"",width:"3070",height:"1492"})}),"\n",(0,s.jsxs)(n.p,{children:["When the build is finished, the status will show ",(0,s.jsx)(n.code,{children:"ready"}),":"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"build status",src:i(5145).A+"",width:"3058",height:"1544"})}),"\n",(0,s.jsxs)(n.p,{children:["To see the full PipelineRun of the build, go to the list of Builds and click on ",(0,s.jsx)(n.code,{children:"PipelineRun"})," of the ",(0,s.jsx)(n.code,{children:"blue"})," build. This will open the Tekton Dashboard and show the status of the PipelineRun of the build:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"build status",src:i(4786).A+"",width:"3056",height:"1878"})}),"\n",(0,s.jsx)(n.p,{children:"When the build is ready you can see the image in Harbor:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Open Harbor."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Click on the project of your team. Here you will see all the registries of the team, including the registry of the new build image."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"build status",src:i(8443).A+"",width:"2904",height:"1026"})}),"\n",(0,s.jsx)(n.h2,{id:"manually-re-run-the-build-task-optional",children:"Manually re-run the build task (optional)"}),"\n",(0,s.jsx)(n.p,{children:"To re-build the image using the same tag, restart the build pipeline using the Tekton cli in the Shell:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Start a shell in the Console"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Get the name of the pipeline"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get pipelines\nNAME                         AGE\ndocker-build-blue-main       41h\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"Get the name of the pipelinerun:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get pipelineruns\nNAME                       SUCCEEDED   REASON      STARTTIME   COMPLETIONTIME\ndocker-build-blue-main     True        Succeeded   41h         41h\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:"Start the pipeline using the pipelinerun:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tkn pipeline start docker-build-blue-main --use-pipelinerun docker-build-blue-main\nPipelineRun started: docker-build-blue-main-j5mmt\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsx)(n.li,{children:"In order to track the PipelineRun progress run:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tkn pipelinerun logs docker-build-blue-main-j5mmt -f\n"})}),"\n",(0,s.jsxs)(n.p,{children:["But it's easier to just open the Tekton dashboard and Click on ",(0,s.jsx)(n.code,{children:"PipelineRuns"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},5145:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/build-status-1-645eab892eb6fa3ac79972f473ce7574.png"},4786:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/build-status-2-5570b7e709e998f51b181fbbdbe894fb.png"},8443:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/build-status-3-2c2ff329951664d48d94f6b767e52c2d.png"},1343:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/build-status-d2670676e4e5de455054e2b1897f32cc.png"},7390:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/select-code-repo-for-build-1085d779e0be17695f849cfceb1f44a4.png"},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var t=i(6540);const s={},l=t.createContext(s);function r(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);