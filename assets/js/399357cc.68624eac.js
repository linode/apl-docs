"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[7245],{251:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"get-started/labs/create-rabbitmq-cluster","title":"Create rabbitMQ Cluster","description":"In this lab we will create a RabbitMQ Cluster using the Rabbitmq-cluster Helm chart from the Catalog.","source":"@site/docs/get-started/labs/create-rabbitmq-cluster.md","sourceDirName":"get-started/labs","slug":"/get-started/labs/create-rabbitmq-cluster","permalink":"/docs/get-started/labs/create-rabbitmq-cluster","draft":false,"unlisted":false,"editUrl":"https://github.com/linode/linode.github.io/tree/main/docs/get-started/labs/create-rabbitmq-cluster.md","tags":[],"version":"current","frontMatter":{"slug":"create-rabbitmq-cluster","title":"Create rabbitMQ Cluster","sidebar_label":"Create RabbitMQ cluster"},"sidebar":"mainSidebar","previous":{"title":"Canary Deployment","permalink":"/docs/get-started/labs/canary-deployment"},"next":{"title":"Overview","permalink":"/docs/for-devs/console/overview"}}');var i=n(4848),r=n(8453);const a={slug:"create-rabbitmq-cluster",title:"Create rabbitMQ Cluster",sidebar_label:"Create RabbitMQ cluster"},c=void 0,l={},o=[{value:"Creating the RabbitMQ Cluster",id:"creating-the-rabbitmq-cluster",level:2},{value:"Accessing the RabbitMQ Management UI",id:"accessing-the-rabbitmq-management-ui",level:2},{value:"Checking the RabbitMQ Management UI",id:"checking-the-rabbitmq-management-ui",level:2},{value:"Connecting an Application to the rabbitMQ Cluster",id:"connecting-an-application-to-the-rabbitmq-cluster",level:2}];function d(e){const t={admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"In this lab we will create a RabbitMQ Cluster using the Rabbitmq-cluster Helm chart from the Catalog."}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsx)(t.p,{children:"For this lab, RabbitMQ Operator needs to be activated."})}),"\n",(0,i.jsx)(t.h2,{id:"creating-the-rabbitmq-cluster",children:"Creating the RabbitMQ Cluster"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["In the left sidebar click on ",(0,i.jsx)(t.code,{children:"Catalog"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Click on the ",(0,i.jsx)(t.code,{children:"rabbitmq-cluster"})," item in the Catalog. This will take you to the page with the readme where you can see all specifications and definitions that you can use to create your RabbitMQ Cluster with Queues and Policies."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Click on the ",(0,i.jsx)(t.code,{children:"Values"})," tab and fill in a name for the RabbitMQ Cluster. In this lab we will create a rabbitMQ Cluster with the name ",(0,i.jsx)(t.code,{children:"rabbit1"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Scroll down and optionally edit the cluster parameters."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Configure ",(0,i.jsx)(t.code,{children:"Queues"})," and ",(0,i.jsx)(t.code,{children:"Policies"})," for the rabbitMQ Cluster with 2 ",(0,i.jsx)(t.code,{children:"queues"})," and 2 ",(0,i.jsx)(t.code,{children:"policies"}),":"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'queues:\n  - name: my-quorum-queue1\n    spec:\n      durable: true\n      arguments:\n        x-queue-type: quorum\n  - name: my-quorum-queue2\n    spec:\n      arguments:\n        autoDelete: true\n\npolicies:\n  - name: my-policy1\n    pattern: ".*"\n    definition:\n      dead-letter-exchange: cc\n      ha-mode: all\n    spec:\n      applyTo: classic_queues\n      priority: 1\n      vhost: "/"\n  - name: my-policy2\n    pattern: ".*"\n    definition:\n      dead-letter-exchange: cc\n      max-age: 1h\n    spec:\n      applyTo: quorum_queues\n'})}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsxs)(t.p,{children:["Remember that even though these values can be edited afterwards, not all specifications or definitions can be updated after a ",(0,i.jsx)(t.code,{children:"queue"})," or ",(0,i.jsx)(t.code,{children:"policy"})," has been created. Please make sure everything is filled in correctly."]})}),"\n",(0,i.jsxs)(t.ol,{start:"6",children:["\n",(0,i.jsxs)(t.li,{children:["Click ",(0,i.jsx)(t.code,{children:"Submit"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"accessing-the-rabbitmq-management-ui",children:"Accessing the RabbitMQ Management UI"}),"\n",(0,i.jsxs)(t.p,{children:["To access the ",(0,i.jsx)(t.code,{children:"RabbitMQ Management UI"})," you have two options:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Retrieve the default user credentials and ",(0,i.jsx)(t.code,{children:"port-forward"})," the ",(0,i.jsx)(t.code,{children:"rabbitMQ server"})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Create a service to expose the ",(0,i.jsx)(t.code,{children:"rabbitMQ server"})," and access the ",(0,i.jsx)(t.code,{children:"Management UI"})," publicly. This is not recommended for production services"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"In this lab we are going to use port-forwarding."}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:["In this example the ",(0,i.jsx)(t.code,{children:"rabbitMQ cluster"})," was created in the Team labs, so we have to get the ",(0,i.jsx)(t.code,{children:"secret"})," from the ",(0,i.jsx)(t.code,{children:"team-labs"})," namespace. Please retrieve the ",(0,i.jsx)(t.code,{children:"secret"})," from the namespace where the ",(0,i.jsx)(t.code,{children:"rabbitMQ cluster"})," was created."]})}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Use the following command to retrieve the username:"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'kubectl get secret rabbit1-quickstart-rabbitmq-default-user -n team-labs -o jsonpath="{.data.username}" | base64 --decode\n'})}),"\n",(0,i.jsxs)(t.ol,{start:"2",children:["\n",(0,i.jsx)(t.li,{children:"Use the following command to retrieve the password:"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'kubectl get secret rabbit1-quickstart-rabbitmq-default-user -n team-labs -o jsonpath="{.data.password}" | base64 --decode\n'})}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsxs)(t.p,{children:["Make sure you don't copy the ",(0,i.jsx)(t.code,{children:"%"})," symbol at the end."]})}),"\n",(0,i.jsxs)(t.p,{children:["Now you have to ",(0,i.jsx)(t.code,{children:"port-forward"})," the rabbitmq ",(0,i.jsx)(t.code,{children:"container"})," with port number ",(0,i.jsx)(t.code,{children:"15672"})," that is inside the rabbitmq ",(0,i.jsx)(t.code,{children:"pod"})," called ",(0,i.jsx)(t.code,{children:"rabbit1-rabbitmq-server-0"})," to a port of your choice that is not used. In this lab we use port ",(0,i.jsx)(t.code,{children:"56027"}),"."]}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"rabbit1-rabbitmq-server-0"})," has the prefix ",(0,i.jsx)(t.code,{children:"rabbit1"})," because this is the name that we gave the cluster."]})}),"\n",(0,i.jsxs)(t.ol,{start:"3",children:["\n",(0,i.jsx)(t.li,{children:"Use the following command to enable the port-forwarding:"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"kubectl port-forward -n team-labs rabbit1-rabbitmq-server-0 56027:15672\n"})}),"\n",(0,i.jsxs)(t.ol,{start:"4",children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Open a browser and go to ",(0,i.jsx)(t.code,{children:"http://localhost:56027"})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Use the previously acquired user credentials to log in. If you cannot log in, please check if the credentials are for the correct rabbitMQ cluster."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Logging-in to Management UI",src:n(7313).A+"",width:"863",height:"252"})}),"\n",(0,i.jsx)(t.h2,{id:"checking-the-rabbitmq-management-ui",children:"Checking the RabbitMQ Management UI"}),"\n",(0,i.jsx)(t.p,{children:"Now that we are logged in you should see the following:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"ManagementUI Overview",src:n(691).A+"",width:"1920",height:"968"})}),"\n",(0,i.jsxs)(t.p,{children:["We can also check the ",(0,i.jsx)(t.code,{children:"queues"})," that we specified when creating the rabbitmq cluster in the ",(0,i.jsx)(t.code,{children:"Queues and Streams"})," tab."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Overview Queues",src:n(717).A+"",width:"2153",height:"486"})}),"\n",(0,i.jsxs)(t.p,{children:["To see the ",(0,i.jsx)(t.code,{children:"policies"})," that we defined you can see them in the ",(0,i.jsx)(t.code,{children:"Admin"})," tab and under ",(0,i.jsx)(t.code,{children:"Policies"}),":"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Overview Policies",src:n(6196).A+"",width:"1919",height:"614"})}),"\n",(0,i.jsx)(t.h2,{id:"connecting-an-application-to-the-rabbitmq-cluster",children:"Connecting an Application to the rabbitMQ Cluster"}),"\n",(0,i.jsxs)(t.p,{children:["To connect to the ",(0,i.jsx)(t.code,{children:"rabbitMQ cluster"})," you use ",(0,i.jsx)(t.code,{children:"AMQP"})," to open a connection. To open a connection you need to create a connection string using the ",(0,i.jsx)(t.code,{children:"username"}),", ",(0,i.jsx)(t.code,{children:"password"}),", ",(0,i.jsx)(t.code,{children:"host"})," and ",(0,i.jsx)(t.code,{children:"port"})," of the rabbitmq cluster."]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Get the host use the following command:"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'kubectl get secret rabbit1-rabbitmq-cluster-default-user -n team-labs -o jsonpath="{.data.host}" | base64 --decode\n'})}),"\n",(0,i.jsxs)(t.ol,{start:"2",children:["\n",(0,i.jsx)(t.li,{children:"Get the port use the following command:"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'kubectl get secret rabbit1-rabbitmq-cluster-default-user -n team-labs -o jsonpath="{.data.port}" | base64 --decode\n'})}),"\n",(0,i.jsx)(t.p,{children:"The connection string is build like this:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"amqp://USERNAME:PASSWORD@HOST:PORT/\n"})}),"\n",(0,i.jsx)(t.p,{children:"With values:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"amqp://default_user_mWPUECo5wsbtpgY3oze:MdzUL4CcgF-cQryLfk5uxqf57qqWBG8l@matthew-rabbit1-rabbitmq.team-admin.svc:5672/\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},717:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/rabbitmq-10-queues-c7282e26180c8b45ad0feff6f3f371c4.png"},6196:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/rabbitmq-11-policies-7b9fd478e92bcfae01acec2631c8f014.png"},7313:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/rabbitmq-8-logging-in-4c9c20d1499ca0bcc942ba7d863a0ed3.png"},691:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/rabbitmq-9-management-ui-0eb14163f450f423a0e19145512cad3e.png"},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>c});var s=n(6540);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);