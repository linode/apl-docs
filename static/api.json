{
  "openapi": "3.0.0",
  "security": [
    {
      "groupAuthz": []
    }
  ],
  "info": {
    "title": "The otomi-stack API",
    "version": "0.4.8"
  },
  "externalDocs": {
    "description": "This is the base url of the external documentation",
    "url": "https://redkubes.github.io/otomi/"
  },
  "x-responses": {
    "BadRequest": {
      "description": "Bad Request",
      "content": {
        "application/json": {
          "schema": {
            "$ref": "#/components/schemas/OpenApiValidationError"
          }
        }
      }
    },
    "OtomiStackError": {
      "description": "Resource already exists",
      "content": {
        "application/json": {
          "schema": {
            "$ref": "#/components/schemas/OtomiStackError"
          }
        }
      }
    },
    "NotFound": {
      "description": "Resource does not exist",
      "content": {
        "application/json": {
          "schema": {
            "$ref": "#/components/schemas/OtomiStackError"
          }
        }
      }
    }
  },
  "x-post-responses": {
    "400": {
      "description": "Bad Request",
      "content": {
        "application/json": {
          "schema": {
            "$ref": "#/components/schemas/OpenApiValidationError"
          }
        }
      }
    },
    "409": {
      "description": "Resource already exists",
      "content": {
        "application/json": {
          "schema": {
            "$ref": "#/components/schemas/OtomiStackError"
          }
        }
      }
    }
  },
  "x-get-responses": {
    "400": {
      "description": "Bad Request",
      "content": {
        "application/json": {
          "schema": {
            "$ref": "#/components/schemas/OpenApiValidationError"
          }
        }
      }
    },
    "404": {
      "description": "Resource does not exist",
      "content": {
        "application/json": {
          "schema": {
            "$ref": "#/components/schemas/OtomiStackError"
          }
        }
      }
    }
  },
  "paths": {
    "/readiness": {
      "get": {
        "security": [],
        "description": "Check readiness",
        "responses": {
          "200": {
            "description": "Service is ready"
          }
        }
      }
    },
    "/clusters": {
      "get": {
        "operationId": "getClusters",
        "description": "Get available clusters",
        "x-aclSchema": "Clusters",
        "responses": {
          "200": {
            "description": "Successfully obtained cluster collection",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Clusters"
                }
              }
            }
          }
        }
      }
    },
    "/secrets": {
      "get": {
        "operationId": "getAllSecrets",
        "description": "Get all secrets",
        "x-aclSchema": "Secrets",
        "responses": {
          "200": {
            "description": "Successfully obtained all secrets",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Secrets"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/services": {
      "get": {
        "operationId": "getAllServices",
        "description": "Get services from a given team",
        "x-aclSchema": "Services",
        "responses": {
          "200": {
            "description": "Successfully obtained all services",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Services"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/teams": {
      "get": {
        "operationId": "getTeams",
        "description": "Get teams collection",
        "x-aclSchema": "Teams",
        "responses": {
          "200": {
            "description": "Successfully obtained teams collection",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Teams"
                }
              }
            }
          }
        }
      },
      "post": {
        "operationId": "createTeam",
        "description": "Create a team",
        "x-aclSchema": "Team",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Team"
              }
            }
          },
          "description": "Team object that needs to be added to the collection",
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successfully obtained teams collection",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Team"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "409": {
            "description": "Resource already exists",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      }
    },
    "/teams/{teamId}": {
      "parameters": [
        {
          "$ref": "#/components/parameters/teamParams"
        }
      ],
      "get": {
        "operationId": "getTeam",
        "description": "Get a specific team",
        "x-aclSchema": "Team",
        "responses": {
          "200": {
            "description": "Successfully obtained team",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Team"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "404": {
            "description": "Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      },
      "put": {
        "operationId": "editTeam",
        "description": "Edit a team",
        "x-aclSchema": "Team",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Team"
              }
            }
          },
          "description": "Team object that contains updated values",
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successfully edited team",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Team"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "404": {
            "description": "Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      },
      "delete": {
        "operationId": "deleteTeam",
        "description": "Delete team",
        "x-aclSchema": "Team",
        "responses": {
          "200": {
            "description": "Successfully deleted a team"
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "404": {
            "description": "Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      }
    },
    "/teams/{teamId}/services": {
      "parameters": [
        {
          "$ref": "#/components/parameters/teamParams"
        }
      ],
      "get": {
        "operationId": "getTeamServices",
        "description": "Get services from a given team",
        "x-aclSchema": "Services",
        "responses": {
          "200": {
            "description": "Successfully obtained services",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Services"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          }
        }
      },
      "post": {
        "operationId": "createService",
        "description": "Create a service",
        "x-aclSchema": "Service",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Service"
              }
            }
          },
          "description": "Service object",
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successfully stored service configuration",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Service"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "409": {
            "description": "Resource already exists",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      }
    },
    "/teams/{teamId}/services/{serviceId}": {
      "parameters": [
        {
          "$ref": "#/components/parameters/teamParams"
        },
        {
          "$ref": "#/components/parameters/serviceParams"
        }
      ],
      "get": {
        "operationId": "getService",
        "description": "Get a service from a given team",
        "x-aclSchema": "Service",
        "responses": {
          "200": {
            "description": "Successfully obtained service configuration",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Service"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "404": {
            "description": "Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      },
      "put": {
        "operationId": "editService",
        "description": "Edit a service from a given team",
        "x-aclSchema": "Service",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Service"
              }
            }
          },
          "description": "Service object that contains updated values",
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successfully edited service",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Service"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "404": {
            "description": "Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      },
      "delete": {
        "operationId": "deleteService",
        "description": "Delete a service from a given team",
        "x-aclSchema": "Service",
        "responses": {
          "200": {
            "description": "Successfully deleted a service"
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "404": {
            "description": "Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      }
    },
    "/teams/{teamId}/secrets": {
      "parameters": [
        {
          "$ref": "#/components/parameters/teamParams"
        }
      ],
      "get": {
        "operationId": "getSecrets",
        "description": "Get secrets from a given team",
        "x-aclSchema": "Secrets",
        "responses": {
          "200": {
            "description": "Successfully obtained secrets",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Secrets"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          }
        }
      },
      "post": {
        "operationId": "createSecret",
        "description": "Create a team secret",
        "x-aclSchema": "Secret",
        "parameters": [
          {
            "name": "teamId",
            "in": "path",
            "description": "ID of team",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Secret"
              }
            }
          },
          "description": "Service object",
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successfully stored secret configuration",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Secret"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "409": {
            "description": "Resource already exists",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      }
    },
    "/teams/{teamId}/secrets/{secretId}": {
      "parameters": [
        {
          "$ref": "#/components/parameters/teamParams"
        },
        {
          "$ref": "#/components/parameters/secretParams"
        }
      ],
      "get": {
        "operationId": "getSecret",
        "description": "Get a secret from a given team",
        "x-aclSchema": "Secret",
        "responses": {
          "200": {
            "description": "Successfully obtained secret configuration",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Secret"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "404": {
            "description": "Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      },
      "put": {
        "operationId": "editSecret",
        "description": "Edit a secret from a given team",
        "x-aclSchema": "Secret",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Secret"
              }
            }
          },
          "description": "Secret object that contains updated values",
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successfully edited a team secret",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Secret"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "404": {
            "description": "Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      },
      "delete": {
        "operationId": "deleteSecret",
        "description": "Delete a secret from a given team",
        "x-aclSchema": "Secret",
        "responses": {
          "200": {
            "description": "Successfully deleted a team secret"
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "404": {
            "description": "Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      }
    },
    "/deploy": {
      "get": {
        "x-aclSchema": "Deployment",
        "operationId": "deploy",
        "description": "Trigger a deployment (only for admin)",
        "responses": {
          "202": {
            "description": "Deployment has been triggered",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "409": {
            "description": "Resource already exists",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      }
    },
    "/kubecfg/{teamId}": {
      "parameters": [
        {
          "$ref": "#/components/parameters/teamParams"
        }
      ],
      "get": {
        "operationId": "downloadKubecfg",
        "description": "Download a kubecfg for a team",
        "x-aclSchema": "Kubecfg",
        "responses": {
          "200": {
            "description": "Succesfully finished the download",
            "content": {
              "application/yaml": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpenApiValidationError"
                }
              }
            }
          },
          "404": {
            "description": "Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OtomiStackError"
                }
              }
            }
          }
        }
      }
    },
    "/session": {
      "get": {
        "security": [],
        "operationId": "getSession",
        "description": "Get the session for the current user",
        "responses": {
          "200": {
            "description": "Get the session for the logged in user",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Session"
                }
              }
            }
          },
          "default": {
            "description": "The requested session."
          }
        }
      }
    },
    "/apiDocs": {
      "get": {
        "security": [],
        "description": "Get OpenApi document",
        "responses": {
          "200": {
            "description": "The requested apiDoc.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "default": {
            "description": "The requested apiDoc."
          }
        }
      }
    }
  },
  "servers": [
    {
      "url": "/v1"
    }
  ],
  "components": {
    "parameters": {
      "teamParams": {
        "name": "teamId",
        "in": "path",
        "description": "ID of team to return",
        "required": true,
        "schema": {
          "type": "string"
        }
      },
      "serviceParams": {
        "name": "serviceId",
        "in": "path",
        "description": "ID of the service",
        "required": true,
        "schema": {
          "type": "string"
        }
      },
      "secretParams": {
        "name": "secretId",
        "in": "path",
        "description": "ID of the secret",
        "required": true,
        "schema": {
          "type": "string"
        }
      }
    },
    "securitySchemes": {
      "groupAuthn": {
        "type": "apiKey",
        "name": "Auth-User",
        "in": "header"
      },
      "groupAuthz": {
        "type": "apiKey",
        "name": "Auth-Group",
        "in": "header"
      }
    },
    "schemas": {
      "Teams": {
        "x-acl": {
          "admin": [
            "read-any"
          ],
          "team": [
            "read-any"
          ]
        },
        "type": "object",
        "properties": {
          "teams": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Team"
            }
          }
        }
      },
      "Cluster": {
        "type": "object",
        "x-acl": {
          "admin": [
            "read-any"
          ],
          "team": [
            "read-any"
          ]
        },
        "properties": {
          "name": {
            "type": "string",
            "description": "A cluster name",
            "readOnly": true
          },
          "cloud": {
            "type": "string",
            "description": "A cloud provider name",
            "readOnly": true
          },
          "domain": {
            "type": "string",
            "description": "A default cluster DNS zone",
            "readOnly": true
          },
          "dnsZones": {
            "type": "array",
            "description": "A list of DNS zones that are available to the cluster",
            "items": {
              "type": "string"
            },
            "readOnly": true,
            "uniqueItems": true
          },
          "hasKnative": {
            "description": "A flag that indicates capability for deploying serverless services by using Knative",
            "type": "boolean",
            "readOnly": true
          },
          "k8sVersion": {
            "description": "A version of kubernetes that is installed on the cluster",
            "type": "string",
            "readOnly": true
          },
          "region": {
            "description": "A physical location of the cluster",
            "type": "string",
            "readOnly": true
          },
          "clusterId": {
            "description": "An unique cluster identifier",
            "type": "string",
            "readOnly": true
          }
        }
      },
      "Clusters": {
        "type": "array",
        "x-acl": {
          "admin": [
            "read-any"
          ],
          "team": [
            "read-any"
          ]
        },
        "items": {
          "$ref": "#/components/schemas/Cluster"
        }
      },
      "Deployment": {
        "x-externalDocsPath": "otomi/docs/deployment",
        "x-acl": {
          "admin": [
            "read-any"
          ],
          "team": [
            "read-any"
          ]
        },
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "status": {
            "type": "string",
            "readOnly": true,
            "description": "Deployment status",
            "enum": [
              "in-progress",
              "completed",
              "failed"
            ]
          }
        }
      },
      "Kubecfg": {
        "type": "object",
        "x-acl": {
          "admin": [
            "read-any"
          ],
          "team": [
            "read"
          ]
        },
        "properties": {}
      },
      "Secret": {
        "x-acl": {
          "admin": [
            "read-any",
            "create-any",
            "delete-any"
          ],
          "team": [
            "read",
            "create",
            "delete"
          ]
        },
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
            "title": "Name",
            "description": "A secret name",
            "example": "secret01"
          },
          "namespace": {
            "type": "string",
            "x-acl": {
              "admin": [
                "read",
                "create"
              ],
              "team": []
            }
          },
          "type": {
            "type": "string",
            "default": "docker-registry"
          }
        },
        "oneOf": [
          {
            "title": "Docker Registry",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "docker-registry"
                ],
                "default": "docker-registry"
              },
              "server": {
                "type": "string",
                "pattern": "^[a-z0-9]+(?:[._-][a-z0-9]+)*$"
              },
              "username": {
                "type": "string"
              },
              "password": {
                "type": "string"
              }
            },
            "required": [
              "server",
              "username",
              "password"
            ]
          },
          {
            "title": "Generic",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "generic"
                ],
                "default": "generic"
              },
              "entries": {
                "type": "array",
                "description": "Key names and their values",
                "items": {
                  "type": "object",
                  "properties": {
                    "key": {
                      "description": "Key or file name",
                      "example": "secretstuff.conf",
                      "type": "string"
                    },
                    "value": {
                      "description": "Value to be encrypted",
                      "example": "password=yoursecretpassword",
                      "type": "string"
                    }
                  },
                  "required": [
                    "key",
                    "value"
                  ]
                }
              }
            },
            "required": [
              "entries"
            ]
          },
          {
            "title": "TLS",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "tls"
                ],
                "default": "tls"
              },
              "crt": {
                "description": "The PEM encoded public key certificate content",
                "type": "string"
              },
              "key": {
                "description": "The private key certificate content",
                "type": "string"
              },
              "ca": {
                "description": "The CA certificate content",
                "type": "string"
              }
            },
            "required": [
              "crt",
              "key"
            ]
          }
        ],
        "required": [
          "type"
        ]
      },
      "Secrets": {
        "x-acl": {
          "admin": [
            "read-any"
          ],
          "team": [
            "read-any"
          ]
        },
        "type": "object",
        "properties": {
          "secrets": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Secret"
            }
          }
        }
      },
      "Service": {
        "x-externalDocsPath": "otomi/docs/configuring-services",
        "x-acl": {
          "admin": [
            "delete-any",
            "read-any",
            "create-any",
            "update-any"
          ],
          "team": [
            "delete",
            "read",
            "create",
            "update"
          ]
        },
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "readOnly": true
          },
          "name": {
            "type": "string",
            "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
            "title": "Name",
            "description": "A service name",
            "example": "some-service"
          },
          "clusterId": {
            "title": "Cluster ID",
            "type": "string",
            "description": "A kubernetes cluster for the service",
            "x-acl": {
              "admin": [
                "read",
                "create"
              ],
              "team": [
                "read",
                "create"
              ]
            }
          },
          "ingress": {
            "title": "Exposure",
            "type": "object",
            "x-acl": {
              "team": [
                "read"
              ]
            },
            "oneOf": [
              {
                "title": "Private",
                "nullable": true,
                "additionalProperties": false
              },
              {
                "title": "Public URL",
                "nullable": true,
                "properties": {
                  "useDefaultSubdomain": {
                    "title": "Use suggested domain (preferred)",
                    "type": "boolean",
                    "default": true,
                    "description": "Allows to use wildcard certs already available (only override for public facing services)"
                  },
                  "subdomain": {
                    "title": "Host",
                    "type": "string",
                    "nullable": true,
                    "description": "A host that is used to set DNS 'A' records",
                    "pattern": "^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]*[a-zA-Z0-9])\\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\\-]*[A-Za-z0-9])$"
                  },
                  "domain": {
                    "title": "DNS Zone",
                    "description": "A managed DNS zone",
                    "type": "string"
                  },
                  "path": {
                    "title": "URL path",
                    "description": "The path in the URL that the service should be mapped to (e.g. for microservices on one app/domain.)",
                    "type": "string"
                  },
                  "forwardPath": {
                    "title": "Forward path",
                    "description": "Forward the URL path into the service (don't rewrite to /)",
                    "type": "boolean"
                  },
                  "hasSingleSignOn": {
                    "title": "Authenticate with Single Sign On",
                    "type": "boolean",
                    "default": false
                  },
                  "hasCert": {
                    "title": "Already has a certificate",
                    "type": "boolean",
                    "default": false,
                    "description": "If true a certificate should exist already"
                  },
                  "certArn": {
                    "type": "string",
                    "title": "Certificate ARN",
                    "example": "arn:aws:acm:eu-central-1:xxx:certificate/xxx"
                  },
                  "certSelect": {
                    "type": "boolean",
                    "title": "Select existing secret name",
                    "default": true
                  },
                  "certName": {
                    "type": "string",
                    "title": "Secret name",
                    "example": "www-example-com"
                  }
                }
              }
            ]
          },
          "ksvc": {
            "title": "Type",
            "type": "object",
            "oneOf": [
              {
                "title": "Knative service",
                "nullable": true,
                "properties": {
                  "serviceType": {
                    "type": "string",
                    "enum": [
                      "ksvc"
                    ],
                    "default": "ksvc"
                  },
                  "scaleToZero": {
                    "title": "Scale to zero",
                    "description": "Scales to zero after 60 seconds and needs approximately 8 seconds to start back up.",
                    "type": "boolean",
                    "default": false
                  },
                  "image": {
                    "title": "Container image",
                    "type": "object",
                    "nullable": true,
                    "properties": {
                      "repository": {
                        "type": "string",
                        "pattern": "^[a-z0-9]+(?:[/._-]{1,2}[a-z0-9]+)*$",
                        "description": "A container image repository"
                      },
                      "tag": {
                        "type": "string"
                      }
                    },
                    "required": [
                      "repository",
                      "tag"
                    ]
                  },
                  "env": {
                    "title": "Environment variables",
                    "type": "array",
                    "nullable": true,
                    "items": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "pattern": "^[a-zA-Z0-9_]*$"
                        },
                        "value": {
                          "type": "string",
                          "maxLength": 131072
                        }
                      },
                      "required": [
                        "name",
                        "value"
                      ]
                    }
                  },
                  "resources": {
                    "title": "Pod resources",
                    "type": "object",
                    "nullable": true,
                    "properties": {
                      "requests": {
                        "type": "object",
                        "properties": {
                          "cpu": {
                            "description": "The guaranteed amount of CPU",
                            "type": "string",
                            "pattern": "^([0-9]+\\.[0-9]{1,2})|([0-9]{2,3}m)?$",
                            "default": "50m"
                          },
                          "memory": {
                            "description": "The guaranteed amount of RAM",
                            "type": "string",
                            "pattern": "^[0-9]+\\.?[0-9]+(E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki)?$",
                            "default": "64Mi"
                          }
                        },
                        "required": [
                          "cpu",
                          "memory"
                        ]
                      },
                      "limits": {
                        "type": "object",
                        "properties": {
                          "cpu": {
                            "description": "The maximal amount of CPU",
                            "type": "string",
                            "pattern": "^([0-9]+\\.[0-9]{1,2})|([0-9]{2,3}m)?$",
                            "default": "100m"
                          },
                          "memory": {
                            "description": "The maximal amount of RAM",
                            "type": "string",
                            "pattern": "^[0-9]+\\.?[0-9]+(E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki)?$",
                            "default": "128Mi"
                          }
                        },
                        "required": [
                          "cpu",
                          "memory"
                        ]
                      }
                    }
                  },
                  "annotations": {
                    "title": "Pod annotations",
                    "description": "Kubernetes annotations with arbitrary metadata",
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "pattern": "^((.){1,253}\\/)?(.){1,63}$"
                        },
                        "value": {
                          "type": "string",
                          "maxLength": 32767
                        }
                      }
                    }
                  },
                  "autoCD": {
                    "title": "Continuous delivery pipeline",
                    "description": "Deploys new images based on a tagging strategy",
                    "type": "object",
                    "oneOf": [
                      {
                        "title": "Off",
                        "nullable": true,
                        "additionalProperties": false
                      },
                      {
                        "title": "Semver versioning",
                        "nullable": true,
                        "properties": {
                          "tagMatcher": {
                            "type": "string",
                            "enum": [
                              "semver"
                            ],
                            "default": "semver"
                          },
                          "semver": {
                            "title": "Semver version pattern",
                            "type": "string",
                            "example": "PATCH only: \"~1.1\", MINOR and PATCH only \"~1\", ALL \"*\",  \">=1.2.3-0\"",
                            "description": "Use this filter if your images tags follow semantic versioning rules (MAJOR.MINOR.PATCH). E.g.: PATCH only: \"~1.1\", MINOR and PATCH only \"~1\", ALL \"*\""
                          }
                        },
                        "required": [
                          "semver"
                        ]
                      },
                      {
                        "title": "Glob pattern matching",
                        "properties": {
                          "tagMatcher": {
                            "type": "string",
                            "enum": [
                              "glob"
                            ],
                            "default": "glob"
                          },
                          "glob": {
                            "title": "Glob string pattern",
                            "type": "string",
                            "description": "Use this filter if you want to make simple non-standard patterns. E.g.: \"master-v1.*.*\"",
                            "example": "master-v1.*.*"
                          }
                        },
                        "required": [
                          "glob"
                        ],
                        "additionalProperties": false
                      }
                    ]
                  }
                }
              },
              {
                "title": "Existing Knative service",
                "properties": {
                  "serviceType": {
                    "type": "string",
                    "enum": [
                      "ksvcPredeployed"
                    ],
                    "default": "ksvcPredeployed"
                  }
                },
                "required": [
                  "serviceType"
                ]
              },
              {
                "title": "Existing Kubernetes service",
                "properties": {
                  "serviceType": {
                    "type": "string",
                    "enum": [
                      "svcPredeployed"
                    ],
                    "default": "svcPredeployed"
                  }
                },
                "required": [
                  "serviceType"
                ]
              }
            ]
          },
          "teamId": {
            "type": "string",
            "readOnly": true
          }
        },
        "required": [
          "name",
          "clusterId"
        ]
      },
      "Services": {
        "x-acl": {
          "admin": [
            "read-any"
          ],
          "team": [
            "read-any"
          ]
        },
        "type": "array",
        "items": {
          "$ref": "#/components/schemas/Service"
        }
      },
      "Session": {
        "x-acl": {
          "admin": [
            "read"
          ],
          "team": [
            "read"
          ]
        },
        "type": "object",
        "properties": {
          "clusters": {
            "readOnly": true,
            "type": "array",
            "items": {
              "type": "string"
            },
            "uniqueItems": true
          },
          "core": {
            "type": "object",
            "readOnly": true
          },
          "currentClusterId": {
            "type": "string",
            "readOnly": true
          },
          "isDirty": {
            "type": "boolean",
            "readOnly": true
          },
          "namespaces": {
            "readOnly": true,
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "user": {
            "type": "object",
            "readOnly": true,
            "properties": {
              "email": {
                "type": "string"
              },
              "teams": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "isAdmin": {
                "type": "boolean"
              },
              "roles": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "Team": {
        "x-externalDocsPath": "otomi/docs/configuring-teams",
        "x-acl": {
          "admin": [
            "delete-any",
            "read-any",
            "create-any",
            "update-any"
          ],
          "team": [
            "read-any",
            "update"
          ]
        },
        "type": "object",
        "properties": {
          "id": {
            "title": "ID",
            "type": "string",
            "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
            "x-acl": {
              "admin": [
                "read"
              ],
              "team": [
                "read"
              ]
            }
          },
          "name": {
            "title": "Name",
            "type": "string",
            "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
            "example": "otomi",
            "x-acl": {
              "admin": [
                "create",
                "read"
              ],
              "team": [
                "read"
              ]
            },
            "description": "A team name"
          },
          "clusters": {
            "title": "Clusters",
            "type": "array",
            "items": {
              "type": "string"
            },
            "uniqueItems": true,
            "minItems": 1,
            "x-acl": {
              "team": [
                "read"
              ]
            }
          },
          "password": {
            "type": "string",
            "writeOnly": true
          },
          "receiver": {
            "title": "Alerting Endpoint",
            "type": "object",
            "anyOf": [
              {
                "title": "Slack",
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "slack"
                    ],
                    "default": "slack"
                  },
                  "url": {
                    "title": "Web hook",
                    "type": "string",
                    "description": "Slack web hook. If none is given the global one is used."
                  },
                  "channel": {
                    "title": "Channel",
                    "type": "string",
                    "description": "Slack channel. If none is given the global one is used. When overridden here, an extra channel with the suffix '-crit' must exist as well!"
                  }
                }
              },
              {
                "title": "Microsoft Teams",
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "msteams"
                    ],
                    "default": "msteams"
                  },
                  "lowPrio": {
                    "title": "High prio webhook",
                    "type": "string",
                    "description": "The low prio web hook"
                  },
                  "highPrio": {
                    "title": "Low prio webhook",
                    "type": "string",
                    "description": "The high prio web hook"
                  }
                }
              },
              {
                "title": "None"
              }
            ]
          },
          "azure": {
            "title": "Azure",
            "type": "object",
            "properties": {
              "monitor": {
                "type": "object",
                "description": "Azure Monitor is the platform service that provides a single source for monitoring Azure resources.",
                "anyOf": [
                  {
                    "title": "No Azure monitoring",
                    "nullable": true,
                    "additionalProperties": false
                  },
                  {
                    "title": "Azure monitoring with global settings",
                    "type": "object",
                    "properties": {
                      "useAdmin": {
                        "type": "boolean",
                        "default": true
                      }
                    },
                    "nullable": true,
                    "additionalProperties": false
                  },
                  {
                    "title": "Azure monitoring with custom settings",
                    "type": "object",
                    "properties": {
                      "clientId": {
                        "description": "An Azure client ID (Azure Active Directory -> App Registrations -> Choose your app -> Application ID)",
                        "type": "string",
                        "pattern": "^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$"
                      },
                      "clientSecret": {
                        "type": "string",
                        "writeOnly": true,
                        "description": "An Azure client secret (Azure Active Directory -> App Registrations -> Choose your app -> Keys -> Create a key -> Use client secret)"
                      },
                      "logAnalyticsClientId": {
                        "description": "A dedicated client ID for Azure Log Analytics. Default: form clientId field",
                        "type": "string",
                        "pattern": "^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$"
                      },
                      "logAnalyticsClientSecret": {
                        "description": "A client Secret for Azure Log Analytics. Default: form clientSecret field",
                        "type": "string",
                        "writeOnly": true
                      },
                      "appInsightsAppId": {
                        "description": "An API key for use with an Application Insights resource. Default: form clientId field",
                        "type": "string"
                      },
                      "appInsightsAppSecret": {
                        "description": "An API secret for use with an Application Insights resource. Default: form clientSecret field",
                        "type": "string",
                        "writeOnly": true
                      }
                    },
                    "required": [
                      "clientId",
                      "clientSecret"
                    ],
                    "nullable": true,
                    "additionalProperties": false
                  }
                ]
              }
            }
          }
        },
        "required": [
          "name",
          "clusters"
        ]
      },
      "OpenApiValidationError": {
        "type": "object",
        "x-acl": [],
        "properties": {
          "status": {
            "type": "integer"
          },
          "errors": {
            "type": "array",
            "items": {
              "type": "object",
              "x-acl": [],
              "properties": {
                "path": {
                  "type": "string"
                },
                "errorCode": {
                  "type": "string"
                },
                "message": {
                  "type": "string"
                },
                "location": {
                  "type": "string",
                  "enum": [
                    "body",
                    "path"
                  ]
                }
              }
            }
          }
        }
      },
      "OtomiStackError": {
        "type": "object",
        "x-acl": [],
        "properties": {
          "message": {
            "type": "string"
          }
        }
      }
    }
  }
}