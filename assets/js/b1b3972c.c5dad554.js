"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[8560],{6123:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>i,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"for-ops/upgrade-notes","title":"Upgrade Notes","description":"About upgrade notes","source":"@site/docs/for-ops/upgrade-notes.md","sourceDirName":"for-ops","slug":"/for-ops/upgrade-notes","permalink":"/docs/for-ops/upgrade-notes","draft":false,"unlisted":false,"editUrl":"https://github.com/linode/linode.github.io/tree/main/docs/for-ops/upgrade-notes.md","tags":[],"version":"current","frontMatter":{"slug":"upgrade-notes","title":"Upgrade Notes","sidebar_label":"Upgrade Notes"},"sidebar":"mainSidebar","previous":{"title":"Upgrade Instructions","permalink":"/docs/for-ops/upgrade-instructions"},"next":{"title":"Known Issues","permalink":"/docs/for-ops/known-issues"}}');var s=o(4848),n=o(8453);const t={slug:"upgrade-notes",title:"Upgrade Notes",sidebar_label:"Upgrade Notes"},l=void 0,i={},d=[{value:"About upgrade notes",id:"about-upgrade-notes",level:2},{value:"v4.4.4 to v4.7.0 or higher",id:"v444-to-v470-or-higher",level:2},{value:"Disable ArgoCD autoSync on harbor-harbor",id:"disable-argocd-autosync-on-harbor-harbor",level:3},{value:"Scale down harbor-jobservice, harbor-core to zero",id:"scale-down-harbor-jobservice-harbor-core-to-zero",level:3},{value:"Scale down the harbor redis to zero",id:"scale-down-the-harbor-redis-to-zero",level:3},{value:"PVC data-harbor-redis-0 is deleted",id:"pvc-data-harbor-redis-0-is-deleted",level:3},{value:"Scale up harbor-redis to one",id:"scale-up-harbor-redis-to-one",level:3},{value:"Wait for pod ready status",id:"wait-for-pod-ready-status",level:3},{value:"Enable ArgoCD autoSync on harbor-harbor",id:"enable-argocd-autosync-on-harbor-harbor",level:3}];function c(e){const r={admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h2,{id:"about-upgrade-notes",children:"About upgrade notes"}),"\n",(0,s.jsx)(r.p,{children:"In some cases between versions upgrades there are issues that can occur, on this page you will find fixes on how to deal with those issues."}),"\n",(0,s.jsx)(r.h2,{id:"v444-to-v470-or-higher",children:"v4.4.4 to v4.7.0 or higher"}),"\n",(0,s.jsx)(r.p,{children:"From v4.4.4 to a higher version there might occur an issue with the harbor redis, which results in the harbor-redis-0 pod restarting indefinitely."}),"\n",(0,s.jsx)(r.p,{children:"To solve this issue you have to delete the harbor redis data according to the following steps."}),"\n",(0,s.jsx)(r.h3,{id:"disable-argocd-autosync-on-harbor-harbor",children:"Disable ArgoCD autoSync on harbor-harbor"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:'kubectl patch application harbor-harbor \\\n  -n argocd \\\n  --type=\'json\' \\\n  -p=\'[{"op": "remove", "path": "/spec/syncPolicy/automated"}]\'\n'})}),"\n",(0,s.jsx)(r.h3,{id:"scale-down-harbor-jobservice-harbor-core-to-zero",children:"Scale down harbor-jobservice, harbor-core to zero"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl scale deploy harbor-jobservice --replicas=0 -n harbor\nkubectl scale deploy harbor-core --replicas=0 -n harbor\n"})}),"\n",(0,s.jsx)(r.admonition,{type:"note",children:(0,s.jsx)(r.p,{children:"If the version you are going to upgrade to is of v4.7.0 or higher you also have to scale down the apl-operator"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl scale deploy apl-operator --replicas=0 -n apl-operator\n"})}),"\n",(0,s.jsx)(r.h3,{id:"scale-down-the-harbor-redis-to-zero",children:"Scale down the harbor redis to zero"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl scale sts harbor-redis --replicas=0 -n harbor\n"})}),"\n",(0,s.jsx)(r.h3,{id:"pvc-data-harbor-redis-0-is-deleted",children:"PVC data-harbor-redis-0 is deleted"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl delete pvc data-harbor-redis-0 -n harbor\n"})}),"\n",(0,s.jsx)(r.h3,{id:"scale-up-harbor-redis-to-one",children:"Scale up harbor-redis to one"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl scale sts harbor-redis --replicas=1 -n harbor\n"})}),"\n",(0,s.jsx)(r.h3,{id:"wait-for-pod-ready-status",children:"Wait for pod ready status"}),"\n",(0,s.jsx)(r.admonition,{type:"note",children:(0,s.jsx)(r.p,{children:"If the version you are going to upgrade to is of v4.7.0 or higher you also have to scale up the apl-operator"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"kubectl scale deploy apl-operator --replicas=1 -n apl-operator\n"})}),"\n",(0,s.jsx)(r.h3,{id:"enable-argocd-autosync-on-harbor-harbor",children:"Enable ArgoCD autoSync on harbor-harbor"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:'kubectl patch application harbor-harbor \\\n  -n argocd \\\n  --type=\'json\' \\\n  -p=\'[{"op": "add", "path": "/spec/syncPolicy/automated", "value": {"prune": true,"selfHeal": true}}]\'\n'})})]})}function h(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,r,o)=>{o.d(r,{R:()=>t,x:()=>l});var a=o(6540);const s={},n=a.createContext(s);function t(e){const r=a.useContext(n);return a.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),a.createElement(n.Provider,{value:r},e.children)}}}]);