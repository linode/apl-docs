"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[2704],{6255:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>d});var i=s(5893),r=s(1151);const l={slug:"troubleshooting",title:"SRE Troubleshooting Checklist",sidebar_label:"Troubleshooting"},t=void 0,c={id:"for-ops/sre/troubleshooting",title:"SRE Troubleshooting Checklist",description:"Pods not starting",source:"@site/docs/for-ops/sre/troubleshooting.md",sourceDirName:"for-ops/sre",slug:"/for-ops/sre/troubleshooting",permalink:"/docs/for-ops/sre/troubleshooting",draft:!1,unlisted:!1,editUrl:"https://github.com/linode/linode.github.io/tree/main/docs/for-ops/sre/troubleshooting.md",tags:[],version:"current",frontMatter:{slug:"troubleshooting",title:"SRE Troubleshooting Checklist",sidebar_label:"Troubleshooting"},sidebar:"mainSidebar",previous:{title:"Daily Routine",permalink:"/docs/for-ops/sre/daily"},next:{title:"Apps Overview",permalink:"/docs/apps/apps-overview"}},o={},d=[{value:"Pods not starting",id:"pods-not-starting",level:2},{value:"Advanced",id:"advanced",level:3},{value:"Pods not running",id:"pods-not-running",level:2},{value:"Advanced",id:"advanced-1",level:3},{value:"Network services not working",id:"network-services-not-working",level:2},{value:"Advanced",id:"advanced-2",level:3},{value:"Istio issues",id:"istio-issues",level:2},{value:"Advanced",id:"advanced-3",level:3},{value:"DNS issues",id:"dns-issues",level:2},{value:"Certificate issues",id:"certificate-issues",level:2},{value:"Storage issues",id:"storage-issues",level:2},{value:"The otomi-pipeline pipeline failure",id:"the-otomi-pipeline-pipeline-failure",level:3},{value:"Advanced",id:"advanced-4",level:3}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"pods-not-starting",children:"Pods not starting"}),"\n",(0,i.jsx)(n.p,{children:"Pods that are unable to start do not show any log output, the issue is related to k8s. Look for a pod with status Pending. Most of the time this is related to resources and container component issues."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Describe the pod, look closely at listed events"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Is the image pullable? Is there a pull secret configured?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Can volumes, configmaps and secrets be mounted?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check resource requests: is the requested resource available?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Are commands and arguments correct? (make sure to use /bin/sh -c as command to use ENV)"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Does the cluster have enough resources available?"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"advanced",children:"Advanced"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check affinity and node selector rules"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Is the image tag valid and compatible with the host CPU? (exec format error)"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check namespace quotas for pod, cm or secret limits etc."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check service account and permissions"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Is the pod a job, deployment, daemonset or statefulset?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Is there a limitrange configured in the namespace?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Is the template spec in the pod matching the running container?"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"pods-not-running",children:"Pods not running"}),"\n",(0,i.jsxs)(n.p,{children:["Pods that are running but restart for whatever reason indicate that a container itself is having issues. Look for pod status ",(0,i.jsx)(n.code,{children:"Crashloop, OOMkilled"})," or ",(0,i.jsx)(n.code,{children:"incomplete ready status (2/3)"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check if DNS resolving works"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Are the required services available to the pod?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check restart count and inspect logs and previous logs"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check if istio injection is required and working"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Is a lifecycle spec configured?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Does the container depend on sidecar containers?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check for available resources requests"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check readiness and liveness probes"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Does the pod have enough CPU resources to do it's job?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Inspect the restart counter for the pod, a high value (32+) indicates an unstable pod"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"advanced-1",children:"Advanced"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check pod's service account permissions"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Attach shell and inspect container status"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Rootless containers need special care combined with volumes"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check securitycontext and pod security policy"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check volume permissions"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"network-services-not-working",children:"Network services not working"}),"\n",(0,i.jsx)(n.p,{children:"Pods are working but a user can't connect to the service. Most HTTP-based services use an Ingress object, non HTTP services require a service port to be defined."}),"\n",(0,i.jsx)(n.p,{children:"Network policies or Istio policies can deny pods from communicating, note that DNS resolving is required for normal operation."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check if network policies are too strict by removing suspect one(s) (if so report an issue to have it/them refactored, if not put back)"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"kubectl port-forward"})," to debug pod service on lowest level"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check if kube-dns / coredns pods are working in kube-system namespace"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check invalid DNS names, too long (64+) or invalid characters"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Attach a shell and perform basic nslookup or ping commands (ping doesn't work between internal services in k8s)"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Confirm that services do not mix http and https in frontend and backend"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Service names matter, prefix accordingly with http- or https- for istio to recognize"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Validate ingress, istio gateway, virtual service and services"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"advanced-2",children:"Advanced"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check for network policies"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Validate Istio pods are working"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check if Istio injection is configured and working"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Validate Istio-operator working"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Run ",(0,i.jsx)(n.code,{children:"istioctl analyze"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"istio-issues",children:"Istio issues"}),"\n",(0,i.jsx)(n.p,{children:"Istio sidecars manipulate the container's network to reroute traffic. A namespace can have an Istio sidecar policy indicated by a label, the same is valid for a deployment or pod. Make sure you see Istio sidecars running when applicable (indicated by the 3/3 Ready status)."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check if istio-operator is working"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check logs for istiod pods"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Are services correctly named? (istio treats http- prefix and https- prefix differently)"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check the logs of the Istio sidecar proxy"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check if mtls is enabled and working"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"advanced-3",children:"Advanced"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Is the correct service account configured?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Is Istio mTLS enabled and configured correctly?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Turn on logging for a context of an istio sidecar: ",(0,i.jsx)(n.code,{children:"ksh exec -it $container_id -c istio-proxy -- sh -c 'curl -k -X POST localhost:15000/logging?jwt=debug'"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"dns-issues",children:"DNS issues"}),"\n",(0,i.jsx)(n.p,{children:"The ExternalDNS service is registering DNS names to makes sure that the service names are publicly available."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Make sure ",(0,i.jsx)(n.code,{children:"external-dns"})," logs indicate All records are already up to date"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Are the credentials configured correctly?"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"certificate-issues",children:"Certificate issues"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check cert-manager working"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Run ",(0,i.jsx)(n.code,{children:"kubectl describe orders.acme.cert-manager.io -A"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Run ",(0,i.jsx)(n.code,{children:"kubectl describe challenges.acme.cert-manager.io -A"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Run ",(0,i.jsx)(n.code,{children:"kubectl describe certificates.cert-manager.io -A"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"storage-issues",children:"Storage issues"}),"\n",(0,i.jsxs)(n.p,{children:["Check available storage classes ",(0,i.jsx)(n.code,{children:"std"})," and ",(0,i.jsx)(n.code,{children:"fast"})," exist"]}),"\n",(0,i.jsx)(n.h3,{id:"the-otomi-pipeline-pipeline-failure",children:"The otomi-pipeline pipeline failure"}),"\n",(0,i.jsxs)(n.p,{children:["In the otomi-pipeline execution failure, read carefully last few lines from the ",(0,i.jsx)(n.code,{children:"PipelineRun`` output. Errors containing: "}),'unable to build kubernetes objects from release manifest: Get "',(0,i.jsx)(n.a,{href:"https://10.32.0.1:443/openapi/v2?timeout=32s",children:"https://10.32.0.1:443/openapi/v2?timeout=32s"}),'": net/http: request canceled',(0,i.jsx)(n.code,{children:"string, indicates that the kube-api was not available. Admin can restart the pipeline by triggering webhook from Gitea app. Go to "}),"otomi/values",(0,i.jsx)(n.code,{children:"repository -> click"}),"Settings",(0,i.jsx)(n.code,{children:"-> select "}),"Webhooks",(0,i.jsx)(n.code,{children:"tab -> click the "}),"Test Delivery` button."]}),"\n",(0,i.jsx)(n.h3,{id:"advanced-4",children:"Advanced"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Describe pv and pvc, check if pv's are ",(0,i.jsx)(n.code,{children:"rwo"})," or ",(0,i.jsx)(n.code,{children:"rwx"})," and look for conflicts"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Check if container expects or ",(0,i.jsx)(n.code,{children:"rwx"})," pv"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>t});var i=s(7294);const r={},l=i.createContext(r);function t(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);