"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[9011],{718:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>c});var t=n(5893),r=n(1151);const l={slug:"custom-rules",title:"Create custom rules",sidebar_label:"Create Custom Rules"},i=void 0,a={id:"get-started/labs/custom-rules",title:"Create custom rules",description:"Now we are exporting metrics, these metrics can also be used to generate alerts. To generate alerts, we first need to create a Prometheus Rule:",source:"@site/docs/get-started/labs/custom-rules.md",sourceDirName:"get-started/labs",slug:"/get-started/labs/custom-rules",permalink:"/docs/get-started/labs/custom-rules",draft:!1,unlisted:!1,editUrl:"https://github.com/redkubes/redkubes.github.io/tree/main/docs/get-started/labs/custom-rules.md",tags:[],version:"current",frontMatter:{slug:"custom-rules",title:"Create custom rules",sidebar_label:"Create Custom Rules"},sidebar:"mainSidebar",previous:{title:"Create Custom Dashboards",permalink:"/docs/get-started/labs/custom-dashboards"},next:{title:"Create Network Policies",permalink:"/docs/get-started/labs/create-netpols"}},o={},c=[{value:"See rules in Prometheus",id:"see-rules-in-prometheus",level:2},{value:"See alerts in Alertmanager",id:"see-alerts-in-alertmanager",level:2}];function d(e){const s={code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.p,{children:["Now we are exporting metrics, these metrics can also be used to generate alerts. To generate alerts, we first need to create a Prometheus ",(0,t.jsx)(s.code,{children:"Rule"}),":"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Go to ",(0,t.jsx)(s.code,{children:"apps"})," and open ",(0,t.jsx)(s.code,{children:"Gitea"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["In the list of repositories there is a repository called ",(0,t.jsx)(s.code,{children:"otomi/team-<team-name>-argocd"}),". Go to this repository."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Click ",(0,t.jsx)(s.code,{children:"Add File"})," and then ",(0,t.jsx)(s.code,{children:"New File"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Name the file ",(0,t.jsx)(s.code,{children:"my-custom-rules.yaml"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Add the following manifest to the file:"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"apiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  labels:\n    prometheus: team-labs # change labs to the name of your team\n  name: labs-custom-rules\nspec:\n  groups:\n  - name: custom.rules\n    rules:\n    - alert: 50GreetingsReached\n      annotations:\n        description: We reached 50 greetings!\n        summary: The number of greetings has reached more than 50.\n      expr: application_greetings_total > 50\n      for: 1m\n      labels:\n        severity: warning\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"6",children:["\n",(0,t.jsx)(s.li,{children:"Commit changes in Gitea."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"see-rules-in-prometheus",children:"See rules in Prometheus"}),"\n",(0,t.jsx)(s.p,{children:"Now let's check to see if Prometheus has picked-up the rule:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Go to ",(0,t.jsx)(s.code,{children:"Apps"})," and open ",(0,t.jsx)(s.code,{children:"Prometheus"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["In the menu click on ",(0,t.jsx)(s.code,{children:"Status"})," and then ",(0,t.jsx)(s.code,{children:"Rules"}),". You should now see the rule:"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"rules",src:n(4402).Z+"",width:"3386",height:"908"})}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["In the menu in Prometheus, click ",(0,t.jsx)(s.code,{children:"Alerts"})]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"You should see an alert has been fired:"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"rules",src:n(1834).Z+"",width:"3382",height:"1154"})}),"\n",(0,t.jsx)(s.h2,{id:"see-alerts-in-alertmanager",children:"See alerts in Alertmanager"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Go to ",(0,t.jsx)(s.code,{children:"Apps"})," and open ",(0,t.jsx)(s.code,{children:"Alertmanager"})]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"You will see Alertmanager has received the alerts from Prometheus:"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"rules",src:n(8538).Z+"",width:"3374",height:"1808"})}),"\n",(0,t.jsx)(s.p,{children:"If a receiver has been configured for the Team, like Slack or email, then you would also have received a message with the alert."})]})}function h(e={}){const{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},4402:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/rules-1-06cfa80a8fa5f1e19f1441789559cfef.png"},1834:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/rules-2-7077d55b7ba5a8e7b95a3a67d20efa35.png"},8538:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/rules-3-081be46d7c9a643be531f1174b298cc0.png"},1151:(e,s,n)=>{n.d(s,{Z:()=>a,a:()=>i});var t=n(7294);const r={},l=t.createContext(r);function i(e){const s=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(l.Provider,{value:s},e.children)}}}]);