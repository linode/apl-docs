"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[3529],{4887:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"for-ops/how-to/change-admin-password","title":"Change the otomi-admin password","description":"This how to provides step-by-step instructions to reset the otomi-admin password.","source":"@site/docs/for-ops/how-to/change-admin-password.md","sourceDirName":"for-ops/how-to","slug":"/for-ops/how-to/change-admin-password","permalink":"/docs/for-ops/how-to/change-admin-password","draft":false,"unlisted":false,"editUrl":"https://github.com/linode/linode.github.io/tree/main/docs/for-ops/how-to/change-admin-password.md","tags":[],"version":"current","frontMatter":{"slug":"change-admin-password","title":"Change the otomi-admin password","sidebar_label":"Change admin password"},"sidebar":"mainSidebar","previous":{"title":"Manage Age","permalink":"/docs/for-ops/how-to/manage-age"},"next":{"title":"Change user passwords","permalink":"/docs/for-ops/how-to/change-user-passwords"}}');var r=n(4848),o=n(8453);const i={slug:"change-admin-password",title:"Change the otomi-admin password",sidebar_label:"Change admin password"},a=void 0,l={},d=[{value:"Prerequisites:",id:"prerequisites",level:2},{value:"Steps:",id:"steps",level:2},{value:"Step 1: Generate a New Password",id:"step-1-generate-a-new-password",level:3},{value:"Step 2: Update the Password in Keycloak",id:"step-2-update-the-password-in-keycloak",level:3},{value:"Step 3: Update the Password in Otomi\u2019s Values Repository",id:"step-3-update-the-password-in-otomis-values-repository",level:3},{value:"Step 4: Re-encrypt the Secrets",id:"step-4-re-encrypt-the-secrets",level:3},{value:"Step 5: Apply the Changes",id:"step-5-apply-the-changes",level:3}];function c(e){const s={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.p,{children:["This how to provides step-by-step instructions to reset the ",(0,r.jsx)(s.code,{children:"otomi-admin"})," password."]}),"\n",(0,r.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Access to the Keycloak admin console."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Docker  installed and configured."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"SOPS set up with Age encryption (default in LKE)."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"steps",children:"Steps:"}),"\n",(0,r.jsx)(s.h3,{id:"step-1-generate-a-new-password",children:"Step 1: Generate a New Password"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"    # Generate a random 16-character alphanumeric password\n    head /dev/urandom | LC_ALL=C tr -dc A-Za-z0-9 | head -c 16\n    # Example output: FPpLvZyAdAmuzc3N\n"})}),"\n",(0,r.jsx)(s.h3,{id:"step-2-update-the-password-in-keycloak",children:"Step 2: Update the Password in Keycloak"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Log in to Keycloak as the ",(0,r.jsx)(s.code,{children:"otomi-admin"})," user."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Go to ",(0,r.jsx)(s.strong,{children:"Users"})," in the left-hand sidebar and find the ",(0,r.jsx)(s.code,{children:"otomi-admin"})," user."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Navigate to the ",(0,r.jsx)(s.strong,{children:"Credentials"})," tab."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Change the password to the one you generated."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Save changes (set Temporary to Disabled)."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.admonition,{type:"info",children:(0,r.jsx)(s.p,{children:"Don\u2019t make any other changes during this operation."})}),"\n",(0,r.jsx)(s.h3,{id:"step-3-update-the-password-in-otomis-values-repository",children:"Step 3: Update the Password in Otomi\u2019s Values Repository"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Clone the Otomi values repository if you haven't already:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"git clone https://gitea.<cluster.domainSuffix>/otomi/values.git ~/workspace/values-folder\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"2",children:["\n",(0,r.jsxs)(s.li,{children:["Export ",(0,r.jsx)(s.code,{children:"ENV_DIR"})," to point to your values directory:"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"export ENV_DIR=~/workspace/values-folder\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"3",children:["\n",(0,r.jsxs)(s.li,{children:["Create the ",(0,r.jsx)(s.code,{children:".secrets"})," file:"]}),"\n"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Retrieve the SOPS_AGE_KEY from secret:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl get secret otomi-sops-secrets -n otomi-pipelines -o jsonpath='{.data.SOPS_AGE_KEY}' | base64 -d\n"})}),"\n",(0,r.jsx)(s.p,{children:"Example output:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"AGE-SECRET-KEY-1KTYK6RVLN5TAPE7VF6FQQSKZ9HWWCDSKUGXXNUQDWZ7XXT5YK5LSF3UTKQ\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Create the ",(0,r.jsx)(s.code,{children:".secrets"})," file in the root of the values directory with the SOPS_AGE_KEY secret. The file contents should look like this:"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"SOPS_AGE_KEY=<PASTE_HERE_THE_SOPS_AGE_KEY>\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"4",children:["\n",(0,r.jsx)(s.li,{children:"Decrypt the secrets in your values repository by running:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker run -it -v $ENV_DIR:/home/app/stack/env linode/apl-core binzx/otomi decrypt\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"5",children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Open the ",(0,r.jsx)(s.code,{children:"env/secrets.settings.yaml.dec"})," file."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Update the ",(0,r.jsx)(s.code,{children:"otomi-admin"})," password:"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"otomi:\n    adminPassword: <YOUR_NEW_PASSWORD>\n"})}),"\n",(0,r.jsx)(s.h3,{id:"step-4-re-encrypt-the-secrets",children:"Step 4: Re-encrypt the Secrets"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Encrypt the ",(0,r.jsx)(s.code,{children:".dec"})," file to secure the updated password:"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"docker run -it -v $ENV_DIR:/home/app/stack/env linode/apl-core binzx/otomi encrypt\n"})}),"\n",(0,r.jsxs)(s.ol,{start:"2",children:["\n",(0,r.jsx)(s.li,{children:"Commit and push your changes to the values repository:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'cd ~/workspace/values-folder\ngit add .\ngit commit -m "Update otomi-admin password"\ngit push\n'})}),"\n",(0,r.jsx)(s.h3,{id:"step-5-apply-the-changes",children:"Step 5: Apply the Changes"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Allow the Tekton pipeline to run and verify it passes."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["After the pipeline completes, restart the ",(0,r.jsx)(s.code,{children:"otomi-api"})," and ",(0,r.jsx)(s.code,{children:"apl-keycloak-operator"})," to ensure it applies the new credentials."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl rollout restart deployment -n otomi otomi-api\nkubectl rollout restart deployment -n apl-keycloak-operator apl-keycloak-operator\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Verify that the Otomi platform is working as expected with the new credentials."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["This completes the password reset process for ",(0,r.jsx)(s.code,{children:"otomi-admin"}),"."]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>a});var t=n(6540);const r={},o=t.createContext(r);function i(e){const s=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);